#+TITLE: Haskellで漢字分析
#+DATE: 2018-03-21
#+AUTHOR: こりん
#+UPDATED: 2020-03-13

私は最初に真面目に作ったHaskellプログラムは「NanQ」と名付けた。「何級」の言葉遊
びだね。日本語を入力すると漢字が級別に分かれて出されるプログラムだった。「級」と
は勿論、日本漢字能力検定（愛称「漢検」）の級のこと。

* 漢検

毎年約3百万人の受験者を誇り、殆どの日本人に聞いたことがあるだろう漢検。漢字の読
み書きができなければ日本での生活は痛い程難しくなる。ある級を合格していないと、雇っ
てくれない会社もあるらしい。この状態が判った上で何十年も学習する日本の学生にとっ
て漢検が良い勉強目標になる。

検定には級が十から一まであって、三級と二級の間に「準二級」も二級と一級の間に「準
一級」もある。最初の六級（十から五）は小学校の各学年で学ぶ漢字とぴったり当てはま
る。十級は一番簡単で８０字だけ要される。大人は普段二級（２１３６字・いわゆる常用
漢字）まで行くがそこまで辿り着くのは決して楽ではない。２０１２年の級別合格率：

[[/assets/pass-rates-jp.png]]

見ての通り二級を受ける２５％以下の人は合格する。国語の先生の私の友達でもかなり勉
強してから二級が取れた。私は準二級まで行けた。

二級で常用漢字が纏まれば、その先には？ますます不思議な、いずれ中国語とほぼ変わら
ない字の海。検定の一級は六千字を要する。中国語圏の国の政府はそれぞれ六千字から七
千字を「常用」とするのは偶然と思えない。勿論、中国系の言語には漢字意外に書く方法
はないから、六千も使われるのは当たり前か。

* 好奇心と分析

検定が試すのは漢字それぞれの読み書きだけではない。用語、四字熟語、対義語、類義語、
文での使い方など、「漢字能力」というのは深い。

私は日本で働いていた頃、よく暇で漢字勉強をしていた。ある日思った：俺の書く文には
漢検のどの級のどの漢字が使われとるやろう・生徒が書く文は？・本とかは？・常用漢字っ
て文字通り日常的？最初に「NanQ」みたいなプログラムを作ろうと思ったのはこの質問が
きっかけだった。

それは２０１１年だった。数年ほっといてHaskellerとして成長してまたコードを見直し
て「何こい、書き直そう」と、二、三回繰り返した。現在プロジェクトは私の [[http://hackage.haskell.org/package/kanji][kanji]] ラ
イブラリとして残っている。ホームページにもデモを置いた。上の「ツール」のリンクか
ら「漢字分析」を選んだら出てくるはず。

** 最初の結果

ドラえもんのウィキペディア記事をデモに入力すると：

[[/assets/doraemon-jp.png]]

文は殆ど小学校レベルの漢字でできたね。もっと具体的に言うと：

*結果その１：平均的に日本語の文に現れる漢字は８６％小学校で学ぶ字。*

誤解に気をつけよう。８６％の /言葉/ が小学校漢字だけでできているという意味ではな
い。「唯一」は良い例になる。「唯」は準二級で「一」は十級。小学校漢字（ただ１００
６字！）のみで一人前になれんぞ。

** ウィキペディア全記事の分析

さて「８６％」とは一体どこから？

[[https://dumps.wikimedia.org/backup-index.html][ウィキのデータベース・ダンプ]]から [[https://github.com/attardi/wikiextractor][字だけ抽出する]] のは結構簡単と半分偶然で発見した。

#+BEGIN_EXAMPLE
colin@yumi ~/c/h/j/data> python ~/code/python/wikiextractor/WikiExtractor.py --json --processes 4 --output out/ jawiki-20180301-pages-articles-multistream.xml
...  # 長い出力・・・
INFO: Finished 4-process extraction of 1097409 articles in 2328.7s (471.3 art/s)
#+END_EXAMPLE

２０１８年3月初日のダンプ（１００万以上の記事！）の10.3gbのXMLから2.5gbのJSONが
生まれた。一行はこんな感じ：

#+BEGIN_SRC json
  {"id": "5", "url": "https://ja.wikipedia.org/wiki?curid=5", "title": "アンパサンド", "text": "アンパサンド..." }
#+END_SRC

とても処理しやすいフォーマット。 [[http://hackage.haskell.org/package/streaming][streaming]]、 [[https://hackage.haskell.org/package/attoparsec][attoparsec]]、 [[https://hackage.haskell.org/package/microlens-aeson-2.3.0][microlens-aeson]]の三つのライブラリでその ~text~ の部分
だけを抜き出して ~Stream (Of Text) IO ()~ を作るのは [[https://github.com/fosskers/jp-wiki][簡単だった]]。あとは私の ~kanji~ ライブラリを混ぜて
全記事の纏め情報が出るまで待つこと：

#+BEGIN_EXAMPLE
colin@yumi ~/c/h/jp-wiki> stack exec -- jp-wiki
Starting...
Elementary: 86.299255
Middle School: 7.0112896
High School: 3.1226614
Above Joyo: 3.5650756
Complete.
#+END_EXAMPLE

*結果その２：平均的にウィキペディアの記事には高校で学ぶ漢字より常用意外の漢字の方が多い。*

なぜ？思いつくのは：

- 人名。日本人の名前によく珍しい字が出る。例えば「澤田」。「澤」とは常用漢字では
  ないが名字としてはそれ程珍しくない。一人生を生き、何千人と出会い、この「澤」が
  読めない老人はいないだろう。
- ウィキペディアの記事はどちらかというと学者風に書かれること。テーマが [[https://ja.wikipedia.org/wiki/%E8%BC%AA%E5%BB%BB][輪廻]]でも
  [[https://ja.wikipedia.org/wiki/%E5%B1%81][屁]]でも小学生が読めそうにない内容だ。ウィキより１００万冊の漫画を分析したら割合
  は上と変わるだろう。
- 人間は学ぶ動物。もう2千字を習った身だったらたまに新しいのを取り入れるのは苦労
  ではない。特に「読み・認識」のためだけであれば。

ま、それでもちょっと計算してみよう。

| 人生段階          | 習った（はずの）字数 | 常用漢字の何割 | 使われる割合 |
|-------------------+----------------------+----------------+--------------|
| 小学校            |                1,006 |          47.1% |        86.3% |
| 中学校            |                  601 |          28.1% |         7.0% |
| 高校 (とそれ以上) |                  529 |          24.8% |         3.1% |

怪しい。

** 分析の続きと提案

個人にも社会にも高い基準が大事だと私は思う。基準があって目標ができ、人間は栄える。
私の判断だったら上の謎の3.5％を含めるように常用漢字を /増やす/ 。 *結果その２*
から判ったのは漢検の上級（3級・準二級・二級・準一級）の字の順番を正す必要もある
ように見える。が、正す道は険しい。気をつけないといけないのは：

- 「唯一」のように極普通の言葉がどう漢検の級を及ぶか。
- 字それぞれがどの頻繁で現れるか。それを元に順番を固定するか、「いや珍しくても日本人として習うべきよ」
  という考えであまり使わない字やその四字熟語を人工的に入れるか。
- どの漢字には「頻繁バブル」があるか。例えばある科学の分野、漫画、スポーツ等ではどの漢字が普段より
  頻繁に出てくるのをどう扱うか。

答えは私には判らないが、常用漢字を正そうと思う組織がどこかあれば、上の問題に対面
しないとならない。しないと時間の無駄になると思う。
